stages:
  - forecast

forecast_job:
  stage: forecast
  image: python:3.11-slim

  cache:
    key: "$CI_COMMIT_REF_SLUG"
    paths:
      - .venv/
      - .cache/pypoetry/

  before_script:
    - python --version
    - pip install --no-cache-dir poetry
    - poetry config virtualenvs.in-project true

  script:
    - poetry install --no-interaction --no-root
    - poetry run python forecasting_bot.py --mode tournament --tournament "spring-2026-ai minibench"

  rules:
    # allow manual run from UI
    - if: '$CI_PIPELINE_SOURCE == "web"'
      when: on_success
    # allow scheduled pipelines
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: on_success
    # otherwise don't run automatically on pushes (optional)
    - when: never
